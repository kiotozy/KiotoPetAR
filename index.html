<script>
  const scene = document.querySelector("a-scene");
  let modelPlaced = false;
  let model;

  scene.addEventListener("ar-hit-test-select", (e) => {
    if (!modelPlaced) {
      model = document.createElement("a-entity");
      model.setAttribute("gltf-model", "#model");
      model.setAttribute("position", e.detail.position);
      model.setAttribute("rotation", "0 180 0");
      model.setAttribute("scale", "0.5 0.5 0.5");
      model.setAttribute("animation-mixer", "");
      scene.appendChild(model);
      modelPlaced = true;
      alert("Modelo adicionado em AR!");
    }
  });

  function playAnimation() {
    if (model) model.setAttribute("animation-mixer", "");
  }
  function stopAnimation() {
    if (model) model.removeAttribute("animation-mixer");
  }
  function playAudio(file) {
    new Audio(file).play();
  }

  document.getElementById("microphoneBtn").onclick = () => {
    if (annyang) {
      const commands = {
        "olÃ¡": () => playAudio("ola.mp3"),
        "bom dia": () => playAudio("bom_dia.mp3"),
        "boa tarde": () => playAudio("boa_tarde.mp3"),
        "boa noite": () => playAudio("boa_noite.mp3"),
        "qual seu nome": () => playAudio("qual_seu_nome.mp3"),
        "quer ser meu amigo": () => playAudio("quer_ser_meu_amigo.mp3"),
        "comandos": () => playAudio("comandos.mp3"),
        "danÃ§ar": () => playAnimation(),
        "parar": () => stopAnimation()
      };
      annyang.addCommands(commands);
      annyang.start({ autoRestart: false, continuous: true });
      alert("ğŸ™ï¸ Comando de voz ativado!");
    } else {
      alert("âŒ Navegador nÃ£o suporta voz.");
    }
  };
</script>
