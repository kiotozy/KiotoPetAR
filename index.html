<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Kioto Pet AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- MindAR + Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.7/dist/mindar-image-three.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <div id="ar-container"></div>

    <button id="toggle-animation" style="position: absolute; top: 10px; left: 10px; z-index: 10;">
      Pausar AnimaÃ§Ã£o
    </button>
    <button id="mic" style="position: absolute; top: 10px; right: 10px; z-index: 10;">
      ðŸŽ¤ Microfone
    </button>

    <audio id="audio" src="audio-nome.mp3"></audio>

    <script>
      const start = async () => {
        const container = document.querySelector("#ar-container");
        const mindarThree = new window.MINDAR.IMAGE.MindARThree({
          container,
          imageTargetSrc: "", // Nenhum marcador
          filterMinCF: 0.0001,
          filterBeta: 0.0001,
        });

        const { renderer, scene, camera } = mindarThree;
        const anchor = mindarThree.addAnchor(0);

        const loader = new THREE.GLTFLoader();
        let mixer, model, action;

        loader.load("kioto.glb", (gltf) => {
          model = gltf.scene;
          model.scale.set(1, 1, 1);
          model.position.set(0, -1, 0);
          anchor.group.add(model);

          mixer = new THREE.AnimationMixer(model);
          action = mixer.clipAction(gltf.animations[0]);
          action.play();
        });

        // BotÃ£o de animaÃ§Ã£o
        let paused = false;
        document.querySelector("#toggle-animation").addEventListener("click", () => {
          if (paused) {
            action.play();
            paused = false;
          } else {
            action.stop();
            paused = true;
          }
        });

        // Reconhecimento de voz
        const micButton = document.getElementById("mic");
        const audio = document.getElementById("audio");

        micButton.addEventListener("click", () => {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          if (!SpeechRecognition) return alert("Seu navegador nÃ£o suporta reconhecimento de voz");

          const recognition = new SpeechRecognition();
          recognition.lang = "pt-BR";
          recognition.start();

          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase();
            if (transcript.includes("olÃ¡")) {
              audio.play();
            }
          };
        });

        // Loop de animaÃ§Ã£o
        const clock = new THREE.Clock();
        renderer.setAnimationLoop(() => {
          const delta = clock.getDelta();
          if (mixer && !paused) mixer.update(delta);
          renderer.render(scene, camera);
        });

        await mindarThree.start();
      };

      start();
    </script>
  </body>
</html>
