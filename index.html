<!DOCTYPE html>
<html>
  <head>
    <title>KiotoPetAR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; }
      .invisible-ui { display: none; }
    </style>
  </head>
  <body>
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;" 
      renderer="logarithmicDepthBuffer: true;"
    >
      <!-- CÃ¢mera -->
      <a-entity camera look-controls position="0 1.6 0"></a-entity>

      <!-- Personagem GLB -->
      <a-entity
        id="kioto-model"
        gltf-model="#kioto"
        position="0 0 -2"
        scale="1 1 1"
        animation-mixer
      ></a-entity>

      <!-- Assets -->
      <a-assets>
        <a-asset-item id="kioto" src="kioto.glb"></a-asset-item>
      </a-assets>

      <!-- UI em AR como plano 2D -->
      <a-entity id="ui-buttons" position="0 0 -1.5" rotation="0 0 0">
        <!-- BotÃ£o Microfone -->
        <a-plane id="btn-mic" color="#444" height="0.3" width="1" position="-1.2 -1.2 0">
          <a-text value="ðŸŽ¤ Microfone" align="center" position="0 0 0.01" color="#fff"></a-text>
        </a-plane>

        <!-- BotÃ£o Pausar -->
        <a-plane id="btn-pause" color="#444" height="0.3" width="1.4" position="0 -1.2 0">
          <a-text id="pause-text" value="â¸ï¸ Pausar" align="center" position="0 0 0.01" color="#fff"></a-text>
        </a-plane>

        <!-- BotÃ£o AR falso (desativado visualmente) -->
        <a-plane visible="false" id="btn-ar" color="#444" height="0.3" width="1" position="1.2 -1.2 0">
          <a-text value="AR" align="center" position="0 0 0.01" color="#fff"></a-text>
        </a-plane>
      </a-entity>
    </a-scene>

    <script>
      let isPaused = false;
      const model = document.querySelector('#kioto-model');
      const btnPause = document.querySelector('#btn-pause');
      const pauseText = document.querySelector('#pause-text');

      btnPause.addEventListener('click', () => {
        if (!model) return;
        isPaused = !isPaused;
        model.setAttribute('animation-mixer', 'timeScale', isPaused ? 0 : 1);
        pauseText.setAttribute('value', isPaused ? 'â–¶ï¸ Reproduzir' : 'â¸ï¸ Pausar');
      });

      // Reconhecimento de voz simples
      const btnMic = document.querySelector('#btn-mic');
      const comandos = {
        'olÃ¡': 'ola.mp3',
        'bom dia': 'bom_dia.mp3',
        'boa tarde': 'boa_tarde.mp3',
        'boa noite': 'boa_noite.mp3',
        'qual seu nome': 'qual_seu_nome.mp3',
        'quer ser meu amigo': 'quer_ser_meu_amigo.mp3'
      };

      let recognition;
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.lang = 'pt-BR';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript.toLowerCase();
          console.log('Reconhecido:', transcript);
          for (const comando in comandos) {
            if (transcript.includes(comando)) {
              new Audio(comandos[comando]).play();
              break;
            }
          }
        };
      }

      btnMic.addEventListener('click', () => {
        if (recognition) recognition.start();
      });
    </script>
  </body>
</html>
