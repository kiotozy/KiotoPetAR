<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  <meta charset="utf-8">
Â  <title>Kioto Pet AR</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/aframe-gesture-detector@3.3.0/dist/aframe-gesture-detector.min.js"></script>
Â  <style>
Â  Â  body { margin: 0; overflow: hidden; font-family: sans-serif; }
Â  Â  #buttons {
Â  Â  Â  position: fixed;
Â  Â  Â  bottom: 20px;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  gap: 10px;
Â  Â  Â  z-index: 1000;
Â  Â  }
Â  Â  button {
Â  Â  Â  padding: 12px 20px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  #micButton { background-color: #03a9f4; }
Â  Â  #micButton.listening { background-color: green; }
Â  Â  #arButton { background-color: #03a9f4; }
Â  Â  #logoutButton {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 10px;
Â  Â  Â  right: 10px;
Â  Â  Â  background-color: #f44336;
Â  Â  Â  z-index: 1001;
Â  Â  }
Â  Â  a-scene {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  z-index: 1;
Â  Â  }
Â  Â  .a-enter-vr-button { display: none !important; }
Â  </style>
Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
Â  <script>
Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyA4p0lhme7RQf1pN0idXgnbUAdR7z_4m2A",
Â  Â  Â  authDomain: "kiotopet.firebaseapp.com",
Â  Â  Â  projectId: "kiotopet",
Â  Â  Â  storageBucket: "kiotopet.firebasestorage.app",
Â  Â  Â  messagingSenderId: "200099219198",
Â  Â  Â  appId: "1:200099219198:web:38d37babfa5fc616fd07af",
Â  Â  Â  measurementId: "G-W493XKCZFQ"
Â  Â  };
Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const auth = firebase.auth();
Â  Â  auth.onAuthStateChanged(user => {
Â  Â  Â  if (!user) window.location.href = "login.html";
Â  Â  });
Â  </script>
</head>
<body>
Â  <div id="buttons">
Â  Â  <button id="micButton">ðŸŽ¤ Falar</button>
Â  Â  <button id="arButton">Ativar AR</button>
Â  </div>
Â  <button id="logoutButton">Sair</button>

Â  <a-scene id="scene" embedded xr-mode-ui="enabled: false" vr-mode-ui="enabled: false" renderer="antialias: true" gesture-detector>
Â  Â  <a-assets>
Â  Â  Â  <a-asset-item id="model" src="kioto.glb"></a-asset-item>
Â  Â  </a-assets>

Â  Â  <a-entity id="glb"
Â  Â  Â  Â  Â  Â  Â  gltf-model="#model"
Â  Â  Â  Â  Â  Â  Â  position="0 0 -2"
Â  Â  Â  Â  Â  Â  Â  scale="0.9 0.9 0.9"
Â  Â  Â  Â  Â  Â  Â  rotation="0 0 0"
Â  Â  Â  Â  Â  Â  Â  animation-mixer="clip: parado"
Â  Â  Â  Â  Â  Â  Â  gesture-detector>
Â  Â  </a-entity>

Â  Â  <a-plane id="ground" position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
Â  Â  <a-sky id="sky" color="#ECECEC"></a-sky>
Â  Â  <a-entity camera position="0 1.6 0" look-controls="enabled: true"></a-entity>
Â  </a-scene>

Â  <script>
Â  Â  const modelEntity = document.getElementById('glb');
Â  Â  const arButton = document.getElementById('arButton');
Â  Â  const micButton = document.getElementById('micButton');
Â  Â  const logoutButton = document.getElementById('logoutButton');
Â  Â  const scene = document.querySelector('a-scene');
Â  Â  const ground = document.getElementById('ground');
Â  Â  const sky = document.getElementById('sky');

Â  Â  logoutButton.addEventListener('click', () => {
Â  Â  Â  auth.signOut().then(() => window.location.href = "login.html");
Â  Â  });

Â  Â  arButton.addEventListener('click', () => {
Â  Â  Â  if (scene.enterAR) {
Â  Â  Â  Â  scene.enterAR().catch(() => alert("Seu dispositivo nÃ£o suporta AR ou permissÃ£o nÃ£o foi concedida."));
Â  Â  Â  }
Â  Â  });

Â  Â  // Ajusta tamanho no modo AR
Â  Â  scene.addEventListener('enter-vr', function () {
Â  Â  Â  if (this.is('ar-mode')) {
Â  Â  Â  Â  ground.setAttribute('visible', 'false');
Â  Â  Â  Â  sky.setAttribute('visible', 'false');
Â  Â  Â  Â  modelEntity.setAttribute('scale', '0.5 0.5 0.5'); // menor no AR
Â  Â  Â  }
Â  Â  });
Â  Â  scene.addEventListener('exit-vr', function () {
Â  Â  Â  modelEntity.setAttribute('scale', '0.9 0.9 0.9'); // volta ao normal
Â  Â  });

Â  Â  // ROTACIONAR MODELO COM DEDO
Â  Â  AFRAME.registerComponent('gesture-detector', {
Â  Â  Â  init: function () {
Â  Â  Â  Â  this.el.sceneEl.addEventListener('onefingermove', (event) => {
Â  Â  Â  Â  Â  const rotation = this.el.getAttribute('rotation');
Â  Â  Â  Â  Â  this.el.setAttribute('rotation', {
Â  Â  Â  Â  Â  Â  x: rotation.x,
Â  Â  Â  Â  Â  Â  y: rotation.y + event.detail.positionChange.x * 2,
Â  Â  Â  Â  Â  Â  z: rotation.z
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });

Â  Â  // ÃUDIO e ANIMAÃ‡Ã•ES
Â  Â  let isSpeaking = false;
Â  Â  let currentAudio = null;
Â  Â  let currentAnimation = null;

Â  Â  function speakText(text) {
Â  Â  Â  if ('speechSynthesis' in window) {
Â  Â  Â  Â  const utterance = new SpeechSynthesisUtterance(text);
Â  Â  Â  Â  utterance.lang = 'pt-BR';
Â  Â  Â  Â  isSpeaking = true;
Â  Â  Â  Â  utterance.onend = () => { isSpeaking = false; };
Â  Â  Â  Â  window.speechSynthesis.speak(utterance);
Â  Â  Â  } else {
Â  Â  Â  Â  console.error("Seu navegador nÃ£o suporta a API de fala.");
Â  Â  Â  }
Â  Â  }

Â  Â  function setAnimation(clipName) {
Â  Â  Â  if (currentAnimation === clipName) return;
Â  Â  Â  modelEntity.setAttribute('animation-mixer', `clip: ${clipName}`);
Â  Â  Â  currentAnimation = clipName;
Â  Â  }

Â  Â  async function processCommand(comando) {
Â  Â  Â  comando = comando.toLowerCase();

Â  Â  Â  // Comandos de animaÃ§Ã£o
Â  Â  Â  if (comando.includes("abdominais")) {
Â  Â  Â  Â  setAnimation("abdominais");
Â  Â  Â  Â  return;
Â  Â  Â  }
      if (comando.includes("break")) {
Â  Â  Â  Â  setAnimation("break");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (comando.includes("chute")) {
Â  Â  Â  Â  setAnimation("chute");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (comando.includes("luta")) {
Â  Â  Â  Â  setAnimation("luta");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (comando.includes("parado")) {
Â  Â  Â  Â  setAnimation("parado");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (comando.includes("polichinelos")) {
Â  Â  Â  Â  setAnimation("polichinelos");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â 
Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch('/.netlify/functions/ask-kioto', {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  body: JSON.stringify({ userText: comando }),
Â  Â  Â  Â  });
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  speakText(data.aiResponse);
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro na comunicaÃ§Ã£o com a IA:", error);
Â  Â  Â  Â  speakText("Desculpe, nÃ£o consigo me conectar com a inteligÃªncia artificial agora.");
Â  Â  Â  }
Â  Â  }

Â  Â  // RECONHECIMENTO DE VOZ
Â  Â  let recognition;
Â  Â  let isListening = false;
Â  Â  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

Â  Â  if (SpeechRecognition) {
Â  Â  Â  recognition = new SpeechRecognition();
Â  Â  Â  recognition.lang = 'pt-BR';
Â  Â  Â  recognition.continuous = false;
Â  Â  Â  recognition.interimResults = false;

Â  Â  Â  micButton.addEventListener('click', () => {
Â  Â  Â  Â  if (isListening) {
Â  Â  Â  Â  Â  recognition.stop();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  if (isSpeaking) {
Â  Â  Â  Â  Â  Â  if (currentAudio) {
Â  Â  Â  Â  Â  Â  Â  currentAudio.pause();
Â  Â  Â  Â  Â  Â  Â  currentAudio.currentTime = 0;
Â  Â  Â  Â  Â  Â  Â  isSpeaking = false;
Â  Â  Â  Â  Â  Â  Â  currentAudio = null;
Â  Â  Â  Â  Â  Â  } else if ('speechSynthesis' in window && window.speechSynthesis.speaking) {
Â  Â  Â  Â  Â  Â  Â  window.speechSynthesis.cancel();
Â  Â  Â  Â  Â  Â  Â  isSpeaking = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  recognition.start();
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  recognition.onstart = () => {
Â  Â  Â  Â  isListening = true;
Â  Â  Â  Â  micButton.classList.add("listening");
Â  Â  Â  Â  micButton.textContent = "ðŸŽ¤ Ouvindo...";
Â  Â  Â  };
Â  Â  Â  recognition.onend = () => {
Â  Â  Â  Â  isListening = false;
Â  Â  Â  Â  micButton.classList.remove("listening");
Â  Â  Â  Â  micButton.textContent = "ðŸŽ¤ Falar";
Â  Â  Â  };
Â  Â  Â  recognition.onresult = (event) => {
Â  Â  Â  Â  const comando = event.results[0][0].transcript;
Â  Â  Â  Â  console.log("Comando de voz:", comando);
Â  Â  Â  Â  processCommand(comando);
Â  Â  Â  };
Â  Â  Â  recognition.onerror = (event) => {
Â  Â  Â  Â  console.error("Erro no reconhecimento de voz:", event.error);
Â  Â  Â  Â  micButton.classList.remove("listening");
Â  Â  Â  Â  micButton.textContent = "ðŸŽ¤ Erro";
Â  Â  Â  };
Â  Â  } else {
Â  Â  Â  alert("Seu navegador nÃ£o suporta reconhecimento de voz.");
Â  Â  }
Â  </script>
</body>
</html>
